# マージソートの解説

このドキュメントでは、マージソートアルゴリズムを実装したCプログラム `merge.c` について解説します。

## 概要

このプログラムは、マージソートアルゴリズムを使用して整数配列を昇順にソートします。また、再帰関数 `mergesort` が呼び出された総回数もカウントします。

## アルゴリズムの解説：マージソート (Merge Sort)

マージソートは、**分割統治法**を用いた効率的なソートアルゴリズムです。計算量は平均・最悪ともに $O(n \log n)$ です。

**基本的な手順:**
1.  **分割 (Divide):** ソート対象の配列を、要素数が1つになるまで半分に分割し続けます。
2.  **統治 (Conquer):** 分割された部分配列を、ソートしながら再帰的に統合（マージ）していきます。
3.  **統合 (Combine):** 最終的に、完全にソートされた1つの配列が完成します。

**特徴:**
-   **安定ソート:** 同じ値を持つ要素の相対的な順序が保存されます。
-   **外部ソートに適している:** データを順次アクセスするため、メモリに収まりきらない大規模なデータのソートに適しています。
-   **追加メモリが必要:** マージ操作のために一時的な作業領域が必要です。

## 主な構成要素

### 1. グローバル変数

- `static int *buff`: マージ処理中に一時的なバッファとして使用されるポインタです。

### 2. `__mergesort` 関数

ソートを実行する中核となる再帰関数です。

- **引数:**
    - `int a[]`: ソート対象の配列。
    - `int left`: 部分配列の開始インデックス。
    - `int right`: 部分配列の終了インデックス。
    - `int *counter`: `__mergesort` が呼び出された回数をカウントする整数へのポインタ。

- **ロジック:**
    1.  `counter` をインクリメントします。
    2.  `left < right` かどうかを確認します（基本ケース：`left >= right` の場合、部分配列の要素数は0または1であり、すでにソート済みとみなされます）。
    3.  中央のインデックス `center` を計算します。
    4.  左半分（`left` から `center`）に対して再帰的に `__mergesort` を呼び出します。
    5.  右半分（`center + 1` から `right`）に対して再帰的に `__mergesort` を呼び出します。
    6.  **マージステップ:**
        -   配列の左半分を一時バッファ `buff` にコピーします。
        -   バッファ（左半分）と元の配列（右半分）の要素を比較し、小さい方の要素を元の配列 `a` に戻します。
        -   バッファに残っている要素があれば、配列にコピーして戻します。

### 3. `mergesort` 関数

ソート処理を初期化するラッパー関数です。

-   `counter` を0に初期化します。
-   `calloc` を使用して一時バッファ `buff` のメモリを確保します。確保に失敗した場合は -1 を返します。
-   再帰関数 `__mergesort` を呼び出します。
-   `buff` 用に確保したメモリを解放します。
-   `counter` の最終的な値を返します。

### 4. `main` 関数

-   標準入力から要素数（`nx`）を読み込みます。
-   サイズ `nx` の配列 `x` のメモリを確保します。
-   標準入力から `nx` 個の整数を配列 `x` に読み込みます。
-   `mergesort` を呼び出して配列をソートし、関数呼び出し回数を取得します。
-   ソートされた配列の要素をスペース区切りで出力します。
-   改行した後、`counter` の値を出力します。
-   配列 `x` 用に確保したメモリを解放します。

## 入出力形式

**入力:**
-   1行目：整数 `nx`（要素数）。
-   続く行：ソート対象の `nx` 個の整数。

**出力:**
-   スペースで区切られたソート済みの配列の値。
-   改行。
-   `__mergesort` 関数呼び出しの総数。
